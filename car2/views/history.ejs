<!DOCTYPE html>
<html lang="th">

<head>
    <meta charset="UTF-8">
    <title>‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥‡∏Å‡∏≤‡∏£‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script charset="utf-8" src="https://static.line-scdn.net/liff/edge/versions/2.22.3/sdk.js"></script>
</head>
<style>
    th,
    td {
        text-align: left !important;
        vertical-align: top;
    }

    .table-container {
        max-width: 800px;
        margin: 0 auto;
    }

    .category-row {
        font-weight: bold;
        background-color: #f0f0f0;
    }
</style>

<body>
    <div class="container mt-5">
        <h2 class="text-center mb-4">üìú ‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥‡∏Å‡∏≤‡∏£‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏¢‡πâ‡∏≠‡∏ô‡∏´‡∏•‡∏±‡∏á 7 ‡∏ß‡∏±‡∏ô</h2>

        <div class="mb-3">
            <label class="form-label">‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏£‡∏ñ</label>
            <select id="plateSelector" class="form-select">
                <option value="">-- ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏£‡∏ñ --</option>
                <option value="‡∏ô‡∏á 3">‡∏ô‡∏á 3</option>
                <option value="9‡∏Å‡∏©1153">9‡∏Å‡∏©1153</option>
                <option value="5‡∏Å‡∏Å7884">5‡∏Å‡∏Å7884</option>
            </select>
        </div>

        <div id="latestInfo" class="mb-4"></div>
        <div id="historyTableContainer"></div>
    </div>



    <!-- ‚úÖ preload checklists ‡∏à‡∏≤‡∏Å server -->
    <script>
        // üìå Vehicle Inspection Checklists
        const checklists = {
            "‡∏ô‡∏á 3": [
                {
                    category: "1.‡∏≠‡∏∏‡∏õ‡∏Å‡∏£‡∏ì‡πå‡πÑ‡∏ü‡∏ü‡πâ‡∏≤", details: [
                        { id: "lan", name: "‡∏ä‡∏∏‡∏î LAN ‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á (1) (Adapter 8)", expected: 1 },
                        { id: "tv-tel", name: "‡∏ä‡∏∏‡∏î TV-TEL (Splitter)", expected: 1 },
                        { id: "adt", name: "‡∏ä‡∏∏‡∏î Adapter ‡πÄ‡∏ä‡πá‡∏Ñ TV-TEL (‡∏™‡∏≥‡∏£‡∏≠‡∏á)", expected: 1 },
                        { id: "rpc", name: "‡∏ä‡∏∏‡∏î‡πÄ‡∏ï‡πâ‡∏≤‡∏£‡∏±‡∏ö (‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á 1 ‡∏™‡∏≤‡∏¢ 1)", expected: 1 },
                        { id: "3p", name: "‡∏ä‡∏∏‡∏î‡∏ß‡∏±‡∏î 3 ‡πÄ‡∏ü‡∏™ (1 ‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á)", expected: 1 },
                        { id: "hvd", name: "‡∏ä‡∏∏‡∏î‡∏ß‡∏±‡∏î‡πÅ‡∏£‡∏á‡∏î‡∏±‡∏ô‡πÑ‡∏ü (1 ‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á)", expected: 1 },
                        { id: "pdmt", name: "‡∏ä‡∏∏‡∏î‡∏ß‡∏±‡∏î‡∏Å‡∏≤‡∏ß (1 ‡∏ä‡∏∏‡∏î)", expected: 1 },
                        { id: "scdv", name: "‡∏ä‡∏∏‡∏î‡πÑ‡∏Ç‡∏Ñ‡∏ß‡∏á (‡∏ò‡∏£‡∏£‡∏°‡∏î‡∏≤ 1 ‡πÑ‡∏ü‡∏ü‡πâ‡∏≤ 1)", expected: 1 },
                        { id: "anm", name: "‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏ß‡∏±‡∏î‡πÅ‡∏£‡∏á‡∏•‡∏° (1 ‡∏ä‡∏∏‡∏î)", expected: 1 },
                        { id: "wwck", name: "‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡πÄ‡∏ä‡πá‡∏Ñ‡∏ô‡πâ‡∏≥‡∏≠‡∏∏‡πà‡∏ô (1 ‡∏ä‡∏∏‡∏î)", expected: 1 },
                        { id: "glo", name: "‡∏ñ‡∏∏‡∏á‡∏°‡∏∑‡∏≠ (1 ‡∏Ñ‡∏π‡πà)", expected: 1 },
                        { id: "scb", name: "‡∏™‡∏≤‡∏¢‡∏ä‡πá‡∏≠‡∏ï (1 ‡∏™‡∏≤‡∏¢)", expected: 1 },
                        { id: "and", name: "‡∏≠‡∏∏‡∏õ‡∏Å‡∏£‡∏ì‡πå‡∏≠‡∏∑‡πà‡∏ô‡πÜ" }// ‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏ó‡∏µ‡πà‡∏Å‡∏≥‡∏´‡∏ô‡∏î
                    ]
                },
                {
                    category: "2.‡∏≠‡∏∏‡∏õ‡∏Å‡∏£‡∏ì‡πå‡∏™‡∏∏‡∏Ç‡∏≤‡∏†‡∏¥‡∏ö‡∏≤‡∏•", details: [
                        { id: "tank", name: "‡∏ñ‡∏±‡∏á", expected: 3 },
                        { id: "cloth", name: "‡∏ú‡πâ‡∏≤", expected: 9 },
                        { id: "psc", name: "‡∏î‡∏¥‡∏ô‡∏ô‡πâ‡∏≥‡∏°‡∏±‡∏ô", expected: 1 },
                        { id: "rbt", name: "‡∏™‡∏≤‡∏¢‡∏¢‡∏≤‡∏á", expected: 5 },
                        { id: "bgs", name: "‡πÄ‡∏Å‡∏ï‡∏∏", expected: 1 },
                        { id: "bread", name: "‡∏Ç‡∏ô‡∏°‡∏õ‡∏±‡∏á", expected: 1 }
                    ]
                },
                {
                    category: "3.‡∏≠‡∏∏‡∏õ‡∏Å‡∏£‡∏ì‡πå‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏´‡∏•‡∏±‡∏á‡∏Ñ‡∏≤", details: [
                        { id: "gst", name: "‡∏ö‡∏±‡∏ô‡πÑ‡∏î‡πÉ‡∏´‡∏ç‡πà", expected: 1 },
                        { id: "sst", name: "‡∏ö‡∏±‡∏ô‡πÑ‡∏î‡πÄ‡∏•‡πá‡∏Å", expected: 1 },
                        { id: "fld", name: "‡∏ö‡∏±‡∏ô‡πÑ‡∏î‡∏•‡∏¥‡∏á", expected: 1 },
                        { id: "tch", name: "‡πÑ‡∏ü‡∏â‡∏≤‡∏¢", expected: 1 }
                    ]
                },
                {
                    category: "4.‡∏≠‡∏∏‡∏õ‡∏Å‡∏£‡∏ì‡πå‡∏Å‡∏•‡πà‡∏≠‡∏á‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö", details: [
                        { id: "ifc", name: "‡∏Å‡∏•‡πâ‡∏≠‡∏á‡∏≠‡∏¥‡∏ô‡∏ü‡∏≤‡πÄ‡∏£‡∏î", expected: 2 },
                        { id: "mtmt", name: "‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏ß‡∏±‡∏î‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ä‡∏∑‡πâ‡∏ô", expected: 2 },
                        { id: "tms", name: "‡∏ï‡∏•‡∏±‡∏ö‡πÄ‡∏°‡∏ï‡∏£", expected: 1 },
                        { id: "msrdv", name: "‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏ß‡∏±‡∏î‡∏ù‡πâ‡∏≤", expected: 1 },
                        { id: "mnmwt", name: "‡∏£‡∏∞‡∏î‡∏±‡∏ö‡∏ô‡πâ‡∏≥‡πÄ‡∏•‡πá‡∏Å", expected: 1 },
                        { id: "tip", name: "‡∏ï‡∏±‡∏ß‡∏ó‡∏¥‡∏õ", expected: 1 },
                        { id: "bct", name: "‡∏õ‡∏µ‡πä‡∏õ", expected: 1 },
                        { id: "dmr", name: "‡∏Å‡∏£‡∏∞‡∏à‡∏Å‡∏™‡πà‡∏≠‡∏á‡∏õ‡∏£‡∏∞‡∏ï‡∏π", expected: 1 },
                        { id: "astc", name: "‡∏ù‡∏≠‡∏¢‡∏î‡∏π‡∏î‡∏≠‡∏≤‡∏Å‡∏≤‡∏®", expected: 1 }
                    ]
                },
                {
                    category: "5.‡∏≠‡∏∏‡∏õ‡∏Å‡∏£‡∏ì‡πå‡∏Å‡∏•‡πà‡∏≠‡∏á‡∏¢‡πà‡∏≠‡∏¢", details: [
                        { id: "tape", name: "‡πÄ‡∏ó‡∏õ", expected: 1 },
                        { id: "asts", name: "‡∏õ‡πâ‡∏≤‡∏¢‡∏ó‡∏∏‡∏Å‡∏£‡∏∞‡∏ö‡∏ö", expected: 1 },
                        { id: "btr", name: "‡∏ñ‡πà‡∏≤‡∏ô", expected: 1 },
                        { id: "plug", name: "‡∏õ‡∏•‡∏±‡πä‡∏Å", expected: 2 },
                        { id: "clc", name: "‡∏ú‡πâ‡∏≤ + ‡πÅ‡∏≠‡∏•‡∏Å‡∏≠‡∏Æ‡∏≠‡∏•‡πå", expected: 1 }
                    ]
                },
                {
                    category: "6.‡∏≠‡∏∏‡∏õ‡∏Å‡∏£‡∏ì‡πå‡∏≠‡∏∑‡πà‡∏ô‡πÜ", details: [
                        { id: "kns", name: "‡πÑ‡∏°‡πâ‡πÄ‡∏Ñ‡∏≤‡∏∞", expected: 5 },
                        { id: "lle", name: "‡∏£‡∏∞‡∏î‡∏±‡∏ö‡∏¢‡∏≤‡∏ß", expected: 1 },
                        { id: "shl", name: "‡∏£‡∏∞‡∏î‡∏±‡∏ö‡∏ô‡πâ‡∏≥‡∏™‡∏±‡πâ‡∏ô", expected: 1 },
                        { id: "brcb", name: "‡∏Å‡∏•‡πâ‡∏≠‡∏á‡∏á‡∏π‡πÉ‡∏´‡∏ç‡πà" },// ‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏ó‡∏µ‡πà‡∏Å‡∏≥‡∏´‡∏ô‡∏î
                        { id: "brcs", name: "‡∏Å‡∏•‡πâ‡∏≠‡∏á‡∏á‡∏π‡πÄ‡∏•‡πá‡∏Å", expected: 1 },
                        { id: "brccd", name: "‡∏Å‡∏•‡πâ‡∏≠‡∏á‡∏á‡∏π‡∏Ñ‡∏≠‡∏ô‡πÇ‡∏î" },// ‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏ó‡∏µ‡πà‡∏Å‡∏≥‡∏´‡∏ô‡∏î
                        { id: "tbct", name: "‡∏ó‡∏µ‡πà‡∏ï‡∏±‡∏î‡∏ó‡πà‡∏≠", expected: 1 },
                        { id: "chair", name: "‡πÄ‡∏Å‡πâ‡∏≤‡∏≠‡∏µ‡πâ", expected: 2 },
                        { id: "pipe", name: "‡∏ó‡πà‡∏≠", expected: 1 },
                        { id: "grille", name: "‡∏ï‡∏∞‡πÅ‡∏Å‡∏£‡∏á", expected: 1 },
                        { id: "hmer", name: "‡∏Ñ‡πâ‡∏≠‡∏ô", expected: 2 },
                        { id: "raincoat", name: "‡πÄ‡∏™‡∏∑‡πâ‡∏≠‡∏Å‡∏±‡∏ô‡∏ù‡∏ô", expected: 1 },
                        { id: "hpsw", name: "‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏â‡∏µ‡∏î‡∏ô‡πâ‡∏≥‡πÅ‡∏£‡∏á‡∏î‡∏±‡∏ô‡∏™‡∏π‡∏á" },// ‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏ó‡∏µ‡πà‡∏Å‡∏≥‡∏´‡∏ô‡∏î
                        { id: "rope", name: "‡πÄ‡∏ä‡∏∑‡∏≠‡∏Å", expected: 1 },
                        { id: "wktk", name: "‡∏ß‡∏≠", expected: 2 },
                        { id: "stc", name: "‡∏™‡∏µ‡πÄ‡∏ó‡∏™‡∏£‡∏∞‡∏ö‡∏ö", expected: 1 },
                        { id: "pliers", name: "‡∏Ñ‡∏µ‡∏°", expected: 1 }
                    ]
                }
            ],
            "9‡∏Å‡∏©1153": [ // ‚úÖ Fixed incorrect plate number
                {
                    category: "1.‡∏≠‡∏∏‡∏õ‡∏Å‡∏£‡∏ì‡πå‡πÑ‡∏ü‡∏ü‡πâ‡∏≤", details: [
                        { id: "lan", name: "‡∏ä‡∏∏‡∏î LAN ‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á (1) (Adapter 8)", expected: 1 },
                        { id: "tv-tel", name: "‡∏ä‡∏∏‡∏î TV-TEL (Splitter)" }, // ‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏ó‡∏µ‡πà‡∏Å‡∏≥‡∏´‡∏ô‡∏î
                        { id: "adt", name: "‡∏ä‡∏∏‡∏î Adapter ‡πÄ‡∏ä‡πá‡∏Ñ TV-TEL (‡∏™‡∏≥‡∏£‡∏≠‡∏á)", expected: 1 },
                        { id: "rpc", name: "‡∏ä‡∏∏‡∏î‡πÄ‡∏ï‡πâ‡∏≤‡∏£‡∏±‡∏ö (‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á 1 ‡∏™‡∏≤‡∏¢ 1)", expected: 1 },
                        { id: "3p", name: "‡∏ä‡∏∏‡∏î‡∏ß‡∏±‡∏î 3 ‡πÄ‡∏ü‡∏™ (1 ‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á)", expected: 1 },
                        { id: "hvd", name: "‡∏ä‡∏∏‡∏î‡∏ß‡∏±‡∏î‡πÅ‡∏£‡∏á‡∏î‡∏±‡∏ô‡πÑ‡∏ü (1 ‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á)", expected: 1 },
                        { id: "pdmt", name: "‡∏ä‡∏∏‡∏î‡∏ß‡∏±‡∏î‡∏Å‡∏≤‡∏ß (1 ‡∏ä‡∏∏‡∏î)", expected: 1 },
                        { id: "scdv", name: "‡∏ä‡∏∏‡∏î‡πÑ‡∏Ç‡∏Ñ‡∏ß‡∏á (‡∏ò‡∏£‡∏£‡∏°‡∏î‡∏≤ 1 ‡πÑ‡∏ü‡∏ü‡πâ‡∏≤ 1)", expected: 2 },
                        { id: "anm", name: "‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏ß‡∏±‡∏î‡πÅ‡∏£‡∏á‡∏•‡∏° (1 ‡∏ä‡∏∏‡∏î)", expected: 1 },
                        { id: "wwck", name: "‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡πÄ‡∏ä‡πá‡∏Ñ‡∏ô‡πâ‡∏≥‡∏≠‡∏∏‡πà‡∏ô (1 ‡∏ä‡∏∏‡∏î)" }, // ‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏ó‡∏µ‡πà‡∏Å‡∏≥‡∏´‡∏ô‡∏î
                        { id: "glo", name: "‡∏ñ‡∏∏‡∏á‡∏°‡∏∑‡∏≠ (1 ‡∏Ñ‡∏π‡πà)", expected: 1 },
                        { id: "scb", name: "‡∏™‡∏≤‡∏¢‡∏ä‡πá‡∏≠‡∏ï (1 ‡∏™‡∏≤‡∏¢)", expected: 1 },
                        { id: "and", name: "‡∏≠‡∏∏‡∏õ‡∏Å‡∏£‡∏ì‡πå‡∏≠‡∏∑‡πà‡∏ô‡πÜ" } // ‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏ó‡∏µ‡πà‡∏Å‡∏≥‡∏´‡∏ô‡∏î
                    ]
                },
                {
                    category: "2.‡∏≠‡∏∏‡∏õ‡∏Å‡∏£‡∏ì‡πå‡∏™‡∏∏‡∏Ç‡∏≤‡∏†‡∏¥‡∏ö‡∏≤‡∏•", details: [
                        { id: "tank", name: "‡∏ñ‡∏±‡∏á", expected: 5 },
                        { id: "cloth", name: "‡∏ú‡πâ‡∏≤", expected: 10 },
                        { id: "psc", name: "‡∏î‡∏¥‡∏ô‡∏ô‡πâ‡∏≥‡∏°‡∏±‡∏ô", expected: 1 },
                        { id: "rbt", name: "‡∏™‡∏≤‡∏¢‡∏¢‡∏≤‡∏á", expected: 2 },
                        { id: "bgs", name: "‡πÄ‡∏Å‡∏ï‡∏∏", expected: 1 },
                        { id: "bread", name: "‡∏Ç‡∏ô‡∏°‡∏õ‡∏±‡∏á", expected: 1 }
                    ]
                },
                {
                    category: "3.‡∏≠‡∏∏‡∏õ‡∏Å‡∏£‡∏ì‡πå‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏´‡∏•‡∏±‡∏á‡∏Ñ‡∏≤", details: [
                        { id: "gst", name: "‡∏ö‡∏±‡∏ô‡πÑ‡∏î‡πÉ‡∏´‡∏ç‡πà", expected: 1 },
                        { id: "sst", name: "‡∏ö‡∏±‡∏ô‡πÑ‡∏î‡πÄ‡∏•‡πá‡∏Å", expected: 1 },
                        { id: "fld", name: "‡∏ö‡∏±‡∏ô‡πÑ‡∏î‡∏•‡∏¥‡∏á", expected: 1 },
                        { id: "tch", name: "‡πÑ‡∏ü‡∏â‡∏≤‡∏¢", expected: 1 }
                    ]
                },
                {
                    category: "4.‡∏≠‡∏∏‡∏õ‡∏Å‡∏£‡∏ì‡πå‡∏Å‡∏•‡πà‡∏≠‡∏á‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö", details: [
                        { id: "ifc", name: "‡∏Å‡∏•‡πâ‡∏≠‡∏á‡∏≠‡∏¥‡∏ô‡∏ü‡∏≤‡πÄ‡∏£‡∏î", expected: 2 },
                        { id: "mtmt", name: "‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏ß‡∏±‡∏î‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ä‡∏∑‡πâ‡∏ô", expected: 1 },
                        { id: "tms", name: "‡∏ï‡∏•‡∏±‡∏ö‡πÄ‡∏°‡∏ï‡∏£", expected: 1 },
                        { id: "msrdv", name: "‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏ß‡∏±‡∏î‡∏ù‡πâ‡∏≤", expected: 1 },
                        { id: "mnmwt", name: "‡∏£‡∏∞‡∏î‡∏±‡∏ö‡∏ô‡πâ‡∏≥‡πÄ‡∏•‡πá‡∏Å", expected: 1 },
                        { id: "tip", name: "‡∏ï‡∏±‡∏ß‡∏ó‡∏¥‡∏õ", expected: 2 },
                        { id: "bct", name: "‡∏õ‡∏µ‡πä‡∏õ", expected: 1 },
                        { id: "dmr", name: "‡∏Å‡∏£‡∏∞‡∏à‡∏Å‡∏™‡πà‡∏≠‡∏á‡∏õ‡∏£‡∏∞‡∏ï‡∏π" }, // ‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏ó‡∏µ‡πà‡∏Å‡∏≥‡∏´‡∏ô‡∏î
                        { id: "astc", name: "‡∏ù‡∏≠‡∏¢‡∏î‡∏π‡∏î‡∏≠‡∏≤‡∏Å‡∏≤‡∏®", expected: 1 }
                    ]
                },
                {
                    category: "5. ‡∏≠‡∏∏‡∏õ‡∏Å‡∏£‡∏ì‡πå‡∏Å‡∏•‡πà‡∏≠‡∏á‡∏¢‡πà‡∏≠‡∏¢", details: [
                        { id: "tape", name: "‡πÄ‡∏ó‡∏õ", expected: 1 },
                        { id: "asts", name: "‡∏õ‡πâ‡∏≤‡∏¢‡∏ó‡∏∏‡∏Å‡∏£‡∏∞‡∏ö‡∏ö", expected: 1 },
                        { id: "btr", name: "‡∏ñ‡πà‡∏≤‡∏ô", expected: 1 },
                        { id: "plug", name: "‡∏õ‡∏•‡∏±‡πä‡∏Å", expected: 2 },
                        { id: "clc", name: "‡∏ú‡πâ‡∏≤ + ‡πÅ‡∏≠‡∏•‡∏Å‡∏≠‡∏Æ‡∏≠‡∏•‡πå", expected: 1 }
                    ]
                },
                {
                    category: "6.‡∏≠‡∏∏‡∏õ‡∏Å‡∏£‡∏ì‡πå‡∏≠‡∏∑‡πà‡∏ô‡πÜ", details: [
                        { id: "kns", name: "‡πÑ‡∏°‡πâ‡πÄ‡∏Ñ‡∏≤‡∏∞", expected: 4 },
                        { id: "lle", name: "‡∏£‡∏∞‡∏î‡∏±‡∏ö‡∏¢‡∏≤‡∏ß", expected: 1 },
                        { id: "shl", name: "‡∏£‡∏∞‡∏î‡∏±‡∏ö‡∏ô‡πâ‡∏≥‡∏™‡∏±‡πâ‡∏ô", expected: 1 },
                        { id: "brcb", name: "‡∏Å‡∏•‡πâ‡∏≠‡∏á‡∏á‡∏π‡πÉ‡∏´‡∏ç‡πà" }, // ‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏ó‡∏µ‡πà‡∏Å‡∏≥‡∏´‡∏ô‡∏î
                        { id: "brcs", name: "‡∏Å‡∏•‡πâ‡∏≠‡∏á‡∏á‡∏π‡πÄ‡∏•‡πá‡∏Å", expected: 1 },
                        { id: "brccd", name: "‡∏Å‡∏•‡πâ‡∏≠‡∏á‡∏á‡∏π‡∏Ñ‡∏≠‡∏ô‡πÇ‡∏î" }, // ‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏ó‡∏µ‡πà‡∏Å‡∏≥‡∏´‡∏ô‡∏î
                        { id: "tbct", name: "‡∏ó‡∏µ‡πà‡∏ï‡∏±‡∏î‡∏ó‡πà‡∏≠", expected: 1 },
                        { id: "chair", name: "‡πÄ‡∏Å‡πâ‡∏≤‡∏≠‡∏µ‡πâ", expected: 1 },
                        { id: "pipe", name: "‡∏ó‡πà‡∏≠", expected: 1 },
                        { id: "grille", name: "‡∏ï‡∏∞‡πÅ‡∏Å‡∏£‡∏á", expected: 1 },
                        { id: "hmer", name: "‡∏Ñ‡πâ‡∏≠‡∏ô", expected: 3 },
                        { id: "raincoat", name: "‡πÄ‡∏™‡∏∑‡πâ‡∏≠‡∏Å‡∏±‡∏ô‡∏ù‡∏ô", expected: 1 },
                        { id: "hpsw", name: "‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏â‡∏µ‡∏î‡∏ô‡πâ‡∏≥‡πÅ‡∏£‡∏á‡∏î‡∏±‡∏ô‡∏™‡∏π‡∏á" }, // ‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏ó‡∏µ‡πà‡∏Å‡∏≥‡∏´‡∏ô‡∏î
                        { id: "rope", name: "‡πÄ‡∏ä‡∏∑‡∏≠‡∏Å", expected: 1 },
                        { id: "wktk", name: "‡∏ß‡∏≠", expected: 2 },
                        { id: "stc", name: "‡∏™‡∏µ‡πÄ‡∏ó‡∏™‡∏£‡∏∞‡∏ö‡∏ö", expected: 1 },
                        { id: "pliers", name: "‡∏Ñ‡∏µ‡∏°", expected: 1 }
                    ]
                }
            ],
            "5‡∏Å‡∏Å7884": [
                {
                    category: "1. ‡∏≠‡∏∏‡∏õ‡∏Å‡∏£‡∏ì‡πå‡πÑ‡∏ü‡∏ü‡πâ‡∏≤", details: [
                        { id: "lan", name: "‡∏ä‡∏∏‡∏î LAN ‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á (1) (Adapter 8)", expected: 1 },
                        { id: "tv-tel", name: "‡∏ä‡∏∏‡∏î TV-TEL (Splitter)", expected: 1 },
                        { id: "adt", name: "‡∏ä‡∏∏‡∏î Adapter ‡πÄ‡∏ä‡πá‡∏Ñ TV-TEL (‡∏™‡∏≥‡∏£‡∏≠‡∏á)", expected: 1 },
                        { id: "rpc", name: "‡∏ä‡∏∏‡∏î‡πÄ‡∏ï‡πâ‡∏≤‡∏£‡∏±‡∏ö (‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á 1 ‡∏™‡∏≤‡∏¢ 1)", expected: 1 },
                        { id: "3p", name: "‡∏ä‡∏∏‡∏î‡∏ß‡∏±‡∏î 3 ‡πÄ‡∏ü‡∏™ (1 ‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á)", expected: 1 },
                        { id: "hvd", name: "‡∏ä‡∏∏‡∏î‡∏ß‡∏±‡∏î‡πÅ‡∏£‡∏á‡∏î‡∏±‡∏ô‡πÑ‡∏ü (1 ‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á)", expected: 1 },
                        { id: "pdmt", name: "‡∏ä‡∏∏‡∏î‡∏ß‡∏±‡∏î‡∏Å‡∏≤‡∏ß (1 ‡∏ä‡∏∏‡∏î)", expected: 1 },
                        { id: "scdv", name: "‡∏ä‡∏∏‡∏î‡πÑ‡∏Ç‡∏Ñ‡∏ß‡∏á (‡∏ò‡∏£‡∏£‡∏°‡∏î‡∏≤ 1 ‡πÑ‡∏ü‡∏ü‡πâ‡∏≤ 1)", expected: 1 },
                        { id: "anm", name: "‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏ß‡∏±‡∏î‡πÅ‡∏£‡∏á‡∏•‡∏° (1 ‡∏ä‡∏∏‡∏î)", expected: 1 },
                        { id: "wwck", name: "‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡πÄ‡∏ä‡πá‡∏Ñ‡∏ô‡πâ‡∏≥‡∏≠‡∏∏‡πà‡∏ô (1 ‡∏ä‡∏∏‡∏î)", expected: 1 },
                        { id: "glo", name: "‡∏ñ‡∏∏‡∏á‡∏°‡∏∑‡∏≠ (1 ‡∏Ñ‡∏π‡πà)", expected: 1 },
                        { id: "scb", name: "‡∏™‡∏≤‡∏¢‡∏ä‡πá‡∏≠‡∏ï (1 ‡∏™‡∏≤‡∏¢)", expected: 1 },
                        { id: "and", name: "‡∏≠‡∏∏‡∏õ‡∏Å‡∏£‡∏ì‡πå‡∏≠‡∏∑‡πà‡∏ô‡πÜ" } // ‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏ó‡∏µ‡πà‡∏Å‡∏≥‡∏´‡∏ô‡∏î
                    ]
                },
                {
                    category: "2. ‡∏≠‡∏∏‡∏õ‡∏Å‡∏£‡∏ì‡πå‡∏™‡∏∏‡∏Ç‡∏≤‡∏†‡∏¥‡∏ö‡∏≤‡∏•", details: [
                        { id: "tank", name: "‡∏ñ‡∏±‡∏á", expected: 5 },
                        { id: "cloth", name: "‡∏ú‡πâ‡∏≤‡πÄ‡∏ä‡πá‡∏î‡πÄ‡∏ó‡πâ‡∏≤", expected: 13 },
                        { id: "psc", name: "‡∏î‡∏¥‡∏ô‡∏ô‡πâ‡∏≥‡∏°‡∏±‡∏ô", expected: 1 },
                        { id: "rbt", name: "‡∏™‡∏≤‡∏¢‡∏¢‡∏≤‡∏á", expected: 3 },
                        { id: "bgs", name: "‡πÄ‡∏Å‡∏ï‡∏∏", expected: 1 },
                        { id: "bread", name: "‡∏Ç‡∏ô‡∏°‡∏õ‡∏±‡∏á", expected: 1 }
                    ]
                },
                {
                    category: "3. ‡∏≠‡∏∏‡∏õ‡∏Å‡∏£‡∏ì‡πå‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏´‡∏•‡∏±‡∏á‡∏Ñ‡∏≤", details: [
                        { id: "gst", name: "‡∏ö‡∏±‡∏ô‡πÑ‡∏î‡πÉ‡∏´‡∏ç‡πà", expected: 1 },
                        { id: "sst", name: "‡∏ö‡∏±‡∏ô‡πÑ‡∏î‡πÄ‡∏•‡πá‡∏Å", expected: 1 },
                        { id: "fld", name: "‡∏ö‡∏±‡∏ô‡πÑ‡∏î‡∏•‡∏¥‡∏á", expected: 1 },
                        { id: "tch", name: "‡πÑ‡∏ü‡∏â‡∏≤‡∏¢", expected: 1 }
                    ]
                },
                {
                    category: "4. ‡∏≠‡∏∏‡∏õ‡∏Å‡∏£‡∏ì‡πå‡∏Å‡∏•‡πà‡∏≠‡∏á‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö", details: [
                        { id: "ifc", name: "‡∏Å‡∏•‡πâ‡∏≠‡∏á‡∏≠‡∏¥‡∏ô‡∏ü‡∏≤‡πÄ‡∏£‡∏î", expected: 2 },
                        { id: "mtmt", name: "‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏ß‡∏±‡∏î‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ä‡∏∑‡πâ‡∏ô", expected: 1 },
                        { id: "tms", name: "‡∏ï‡∏•‡∏±‡∏ö‡πÄ‡∏°‡∏ï‡∏£", expected: 1 },
                        { id: "msrdv", name: "‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏ß‡∏±‡∏î‡∏ù‡πâ‡∏≤", expected: 1 },
                        { id: "mnmwt", name: "‡∏£‡∏∞‡∏î‡∏±‡∏ö‡∏ô‡πâ‡∏≥‡πÄ‡∏•‡πá‡∏Å", expected: 1 },
                        { id: "tip", name: "‡∏ï‡∏±‡∏ß‡∏ó‡∏¥‡∏õ", expected: 1 },
                        { id: "bct", name: "‡∏õ‡∏µ‡πä‡∏õ", expected: 1 },
                        { id: "dmr", name: "‡∏Å‡∏£‡∏∞‡∏à‡∏Å‡∏™‡πà‡∏≠‡∏á‡∏õ‡∏£‡∏∞‡∏ï‡∏π", expected: 1 },
                        { id: "astc", name: "‡∏ù‡∏≠‡∏¢‡∏î‡∏π‡∏î‡∏≠‡∏≤‡∏Å‡∏≤‡∏®", expected: 1 }
                    ]
                },
                {
                    category: "5. ‡∏≠‡∏∏‡∏õ‡∏Å‡∏£‡∏ì‡πå‡∏Å‡∏•‡πà‡∏≠‡∏á‡∏¢‡πà‡∏≠‡∏¢", details: [
                        { id: "tape", name: "‡πÄ‡∏ó‡∏õ", expected: 1 },
                        { id: "asts", name: "‡∏õ‡πâ‡∏≤‡∏¢‡∏ó‡∏∏‡∏Å‡∏£‡∏∞‡∏ö‡∏ö", expected: 1 },
                        { id: "btr", name: "‡∏ñ‡πà‡∏≤‡∏ô", expected: 1 },
                        { id: "plug", name: "‡∏õ‡∏•‡∏±‡πä‡∏Å", expected: 2 },
                        { id: "clc", name: "‡∏ú‡πâ‡∏≤ + ‡πÅ‡∏≠‡∏•‡∏Å‡∏≠‡∏Æ‡∏≠‡∏•‡πå", expected: 1 }
                    ]
                },
                {
                    category: "6. ‡∏≠‡∏∏‡∏õ‡∏Å‡∏£‡∏ì‡πå‡∏≠‡∏∑‡πà‡∏ô‡πÜ", details: [
                        { id: "kns", name: "‡πÑ‡∏°‡πâ‡πÄ‡∏Ñ‡∏≤‡∏∞", expected: 5 },
                        { id: "lle", name: "‡∏£‡∏∞‡∏î‡∏±‡∏ö‡∏¢‡∏≤‡∏ß", expected: 1 },
                        { id: "shl", name: "‡∏£‡∏∞‡∏î‡∏±‡∏ö‡∏ô‡πâ‡∏≥‡∏™‡∏±‡πâ‡∏ô", expected: 1 },
                        { id: "brcb", name: "‡∏Å‡∏•‡πâ‡∏≠‡∏á‡∏á‡∏π‡πÉ‡∏´‡∏ç‡πà" }, // ‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏ó‡∏µ‡πà‡∏Å‡∏≥‡∏´‡∏ô‡∏î
                        { id: "brcs", name: "‡∏Å‡∏•‡πâ‡∏≠‡∏á‡∏á‡∏π‡πÄ‡∏•‡πá‡∏Å", expected: 1 },
                        { id: "brccd", name: "‡∏Å‡∏•‡πâ‡∏≠‡∏á‡∏á‡∏π‡∏Ñ‡∏≠‡∏ô‡πÇ‡∏î" }, // ‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏ó‡∏µ‡πà‡∏Å‡∏≥‡∏´‡∏ô‡∏î
                        { id: "tbct", name: "‡∏ó‡∏µ‡πà‡∏ï‡∏±‡∏î‡∏ó‡πà‡∏≠", expected: 1 },
                        { id: "chair", name: "‡πÄ‡∏Å‡πâ‡∏≤‡∏≠‡∏µ‡πâ", expected: 2 },
                        { id: "pipe", name: "‡∏ó‡πà‡∏≠", expected: 1 },
                        { id: "grille", name: "‡∏ï‡∏∞‡πÅ‡∏Å‡∏£‡∏á", expected: 1 },
                        { id: "hmer", name: "‡∏Ñ‡πâ‡∏≠‡∏ô", expected: 1 },
                        { id: "raincoat", name: "‡πÄ‡∏™‡∏∑‡πâ‡∏≠‡∏Å‡∏±‡∏ô‡∏ù‡∏ô", expected: 1 },
                        { id: "hpsw", name: "‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏â‡∏µ‡∏î‡∏ô‡πâ‡∏≥‡πÅ‡∏£‡∏á‡∏î‡∏±‡∏ô‡∏™‡∏π‡∏á" }, // ‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏ó‡∏µ‡πà‡∏Å‡∏≥‡∏´‡∏ô‡∏î
                        { id: "rope", name: "‡πÄ‡∏ä‡∏∑‡∏≠‡∏Å", expected: 1 },
                        { id: "wktk", name: "‡∏ß‡∏≠", expected: 2 },
                        { id: "stc", name: "‡∏™‡∏µ‡πÄ‡∏ó‡∏™‡∏£‡∏∞‡∏ö‡∏ö", expected: 1 },
                        { id: "pliers", name: "‡∏Ñ‡∏µ‡∏°", expected: 1 }
                    ]
                }
            ]
        };
    </script>



    <script>
        function formatDate(dateStr) {
            const date = new Date(dateStr);
            return date.toLocaleDateString("th-TH", { day: 'numeric', month: 'numeric', year: 'numeric' });
        }

        function toThaiDateTime(dateStr) {
            const date = new Date(dateStr);
            return date.toLocaleString("th-TH", { day: 'numeric', month: 'long', year: 'numeric', hour: '2-digit', minute: '2-digit' });
        }

        async function initializeLiff() {
            try {
                await liff.init({ liffId: "2007063611-2LjAaylQ" });

                if (!liff.isLoggedIn()) {
                    liff.login();
                } else {
                    const profile = await liff.getProfile();
                    const userId = profile.userId;
                    console.log("üì¢ userId:", userId);

                    $("#plateSelector").on("change", function () {
                        const selectedPlate = $(this).val();
                        if (selectedPlate) loadHistory(userId, selectedPlate);
                    });
                }
            } catch (error) {
                console.error("üî• LIFF Error:", error);
            }
        }

        function loadHistory(userId, selectedPlate) {
            $.get(`/checklist-history/${userId}`, function (entries) {
                const filtered = entries.filter(e => e.plate_number === selectedPlate);
                if (!filtered.length) {
                    $("#historyTableContainer").html('<div class="alert alert-warning">‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•</div>');
                    return;
                }

                // ‡∏î‡∏∂‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ú‡∏π‡πâ‡∏ï‡∏£‡∏ß‡∏à‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î
                const latest = filtered[0];
                const submittedAt = toThaiDateTime(latest.submitted_at);
                const latestHtml = `
                <p>üìã ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡πÇ‡∏î‡∏¢: ${latest.inspector}</p>
                <p>üìÖ ‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà: ${submittedAt}</p>
                <p>üöó ‡∏õ‡πâ‡∏≤‡∏¢‡∏ó‡∏∞‡πÄ‡∏ö‡∏µ‡∏¢‡∏ô: ${latest.plate_number}</p>
            `;
                $("#latestInfo").html(latestHtml);

                const grouped = {};
                const dates = [];

                filtered.forEach(entry => {
                    const date = formatDate(entry.submitted_at);
                    dates.push(date);
                    const equipment = typeof entry.equipment === "string" ? JSON.parse(entry.equipment) : entry.equipment;
                    const checklist = checklists[entry.plate_number] || [];

                    checklist.forEach(cat => {
                        if (!grouped[cat.category]) grouped[cat.category] = {};
                        cat.details.forEach(detail => {
                            if (!grouped[cat.category][detail.name]) grouped[cat.category][detail.name] = {};
                        });
                    });

                    equipment.forEach(item => {
                        const checklist = checklists[entry.plate_number] || [];
                        checklist.forEach(cat => {
                            const found = cat.details.find(d => d.id === item.name);
                            if (found) {
                                const name = found.name;
                                const qty = item.quantity || 0;
                                const expected = found.expected || 0;
                                let status = qty > 0 ? `‡∏°‡∏µ ${qty}` : "‡πÑ‡∏°‡πà‡∏°‡∏µ";
                                if (expected > 0) {
                                    if (qty === expected) status += " ‡∏Ñ‡∏£‡∏ö";
                                    else if (qty < expected) status += ` ‡∏Ç‡∏≤‡∏î ${expected - qty}`;
                                }
                                if (item.remark) status += `${item.remark}`;
                                const dateKey = formatDate(entry.submitted_at);
                                grouped[cat.category][found.name][dateKey] = status;
                            }
                        });
                    });
                });

                const sortedDates = [...new Set(dates)].sort((a, b) => new Date(a) - new Date(b));

                let html = '<table class="table table-bordered"><thead><tr><th>‡∏´‡∏°‡∏ß‡∏î / ‡∏≠‡∏∏‡∏õ‡∏Å‡∏£‡∏ì‡πå</th>';
                sortedDates.forEach(date => html += `<th>${date}</th>`);
                html += '</tr></thead><tbody>';

                Object.entries(grouped).forEach(([category, items]) => {
                    html += `<tr class="category-row"><td colspan="${sortedDates.length + 1}">${category}</td></tr>`;
                    Object.entries(items).forEach(([name, statusByDate]) => {
                        html += `<tr><td>${name}</td>`;
                        sortedDates.forEach(date => {
                            html += `<td>${statusByDate[date] || '-'}</td>`;
                        });
                        html += '</tr>';
                    });
                });

                html += '</tbody></table>';
                $("#historyTableContainer").html(html);
            });
        }

        initializeLiff();
    </script>
</body>

</html>